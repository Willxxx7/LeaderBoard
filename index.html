<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ¥‡ Hot Beans Leaderboard - WebPageTest</title>
  <style>
    :root {
      --bg: linear-gradient(135deg, #f04e23, #ff6f47);
      --card: rgba(255,255,255,0.95);
      --text: #333;
      --accent: #f04e23;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, Arial, sans-serif;
      background: var(--bg);
      min-height: 100vh;
      padding: 2rem;
    }
    .container { max-width: 1200px; margin: 0 auto; }
    
    h1 {
      text-align: center; font-size: clamp(2rem, 5vw, 3.5rem);
      background: var(--card); padding: 1.5rem; 
      border-radius: 20px; margin-bottom: 2rem; 
      box-shadow: 0 15px 35px rgba(0,0,0,0.2);
    }
    
    .submit-info, .leaderboard, .pending-section {
      background: var(--card); border-radius: 20px; padding: 2.5rem;
      margin-bottom: 2rem; box-shadow: 0 20px 50px rgba(0,0,0,0.2);
    }
    
    .submit-info { border-left: 5px solid #ffc107; }
    .leaderboard { border-left: 5px solid var(--accent); }
    .pending-section { border-left: 5px solid #28a745; display: none; }
    
    .teacher-controls {
      position: fixed; top: 20px; right: 20px; 
      background: #28a745; color: white; padding: 1rem;
      border-radius: 10px; cursor: pointer; z-index: 100;
      font-weight: bold;
    }
    
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { padding: 1rem 0.5rem; text-align: left; }
    th { background: #f8f4f0; font-weight: 800; text-transform: uppercase; font-size: 0.85rem; }
    tr { border-bottom: 1px solid #eee; }
    tr:hover { background: rgba(240,78,35,0.08); }
    
    .rank-1 { background: linear-gradient(90deg, #ffd700, #ffed4e) !important; }
    .rank-2 { background: linear-gradient(90deg, #c0c0c0, #e5e5e5) !important; }
    .rank-3 { background: linear-gradient(90deg, #cd7f32, #daa520) !important; }
    
    .score-badge { padding: 0.4rem 1.2rem; border-radius: 25px; font-weight: 900; }
    .score-90plus { background: #28a745; color: white; }
    
    .repo-link { 
      background: #6c757d; color: white; padding: 0.3rem 0.8rem;
      border-radius: 15px; font-size: 0.8rem; text-decoration: none; 
    }
    
    .approval-btn {
      padding: 0.5rem 1rem; border: none; border-radius: 15px;
      cursor: pointer; font-weight: 800; margin: 0.2rem; font-size: 0.85rem;
    }
    .approval-yes { background: #28a745; color: white; }
    .approval-no { background: #dc3545; color: white; }
    .approval-testing { background: #ffc107; color: #333; }
    
    #loginPrompt, #testProgress {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.9); display: none; z-index: 200;
      align-items: center; justify-content: center;
    }
    
    .loading-spinner {
      border: 4px solid #f3f3f3; border-top: 4px solid var(--accent);
      border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    
    @media (max-width: 768px) {
      body { padding: 1rem; }
      .teacher-controls { position: static; margin: 1rem auto; }
    }
  </style>
</head>
<body>
  <div class="teacher-controls" id="teacherControls">ğŸ‘¨â€ğŸ« TEACHER LOGIN</div>
  
  <div class="container">
    <h1>ğŸ¥‡ Hot Beans Web Dev Leaderboard</h1>
    
    <div class="submit-info">
      <h2>ğŸš€ Deploy + Submit</h2>
      <ol>
        <li>Fork: <a href="https://github.com/Willxxx7/hot-beans-web">hot-beans-web</a></li>
        <li>Build portfolio â†’ Push to main</li>
        <li>Settings â†’ Pages â†’ Deploy from main</li>
        <li><strong>Email Mr. Will your URL!</strong></li>
      </ol>
    </div>
    
    <div class="pending-section" id="pendingSection">
      <h2>â³ Pending Approvals</h2>
      <button onclick="addPendingEntry()" style="background:var(--accent);color:white;padding:1rem 2rem;border:none;border-radius:25px;cursor:pointer;font-weight:800;margin-bottom:1rem;">
        â• ADD STUDENT SUBMISSION
      </button>
      <div id="pendingList"></div>
    </div>
    
    <div class="leaderboard">
      <h2>ğŸ”¥ Live Class Rankings</h2>
      <table>
        <thead>
          <tr><th>ğŸ¥‡</th><th>ğŸ‘¨â€ğŸ’» Student</th><th>ğŸŒ Site</th><th>ğŸ“‚ Repo</th><th>âš¡ Speed Index</th><th>ğŸ¯ Score</th><th>ğŸ—‘ï¸</th></tr>
        </thead>
        <tbody id="leaderboard"></tbody>
      </table>
    </div>
  </div>

  <!-- LOGIN & TESTING MODALS -->
  <div id="loginPrompt">
    <div style="background:white;padding:2rem;border-radius:20px;text-align:center;max-width:400px;width:90%;">
      <h2>ğŸ”’ Teacher Login</h2>
      <input type="password" id="teacher-password" placeholder="Password" style="width:100%;padding:1rem;border:2px solid var(--accent);border-radius:10px;font-size:1.1rem;margin:1rem 0;">
      <button onclick="login()" style="background:var(--accent);color:white;border:none;padding:1rem 2rem;border-radius:25px;cursor:pointer;font-weight:bold;">Login</button>
      <div id="login-status" style="margin-top:1rem;color:#dc3545;"></div>
    </div>
  </div>

  <div id="testProgress">
    <div style="background:white;padding:3rem;border-radius:20px;text-align:center;max-width:400px;width:90%;">
      <div class="loading-spinner"></div>
      <h3>ğŸš€ Running WebPageTest...</h3>
      <p id="testStatus">Testing <strong id="testUrl"></strong></p>
      <div id="testResult"></div>
    </div>
  </div>

  <script>
    const TEACHER_PASSWORD = "hotbeans2026";
    const WPT_PUBLIC_URL = "https://www.webpagetest.org"; // Public WebPageTest
    let isLoggedIn = localStorage.getItem('teacher-logged-in') === 'true';
    let leaderboard = JSON.parse(localStorage.getItem('leaderboard-approved')) || [];
    let pending = JSON.parse(localStorage.getItem('leaderboard-pending')) || [];

    renderLeaderboard();
    if (isLoggedIn) {
      document.getElementById('teacherControls').innerHTML = 'âœ… Teacher Active | <button onclick="logout()" style="background:none;border:none;color:white;cursor:pointer;">Logout</button>';
      document.getElementById('pendingSection').style.display = 'block';
      renderPending();
    }

    document.getElementById('teacherControls').onclick = function(e) {
      if (!isLoggedIn) document.getElementById('loginPrompt').style.display = 'flex';
    };

    function login() {
      if (document.getElementById('teacher-password').value === TEACHER_PASSWORD) {
        isLoggedIn = true;
        localStorage.setItem('teacher-logged-in', 'true');
        document.getElementById('loginPrompt').style.display = 'none';
        document.getElementById('teacherControls').innerHTML = 'âœ… Teacher Active | <button onclick="logout()" style="background:none;border:none;color:white;cursor:pointer;">Logout</button>';
        document.getElementById('pendingSection').style.display = 'block';
        document.getElementById('teacher-password').value = '';
        renderPending();
      } else {
        document.getElementById('login-status').innerHTML = 'âŒ Wrong password!';
      }
    }

    function logout() {
      isLoggedIn = false;
      localStorage.removeItem('teacher-logged-in');
      document.getElementById('teacherControls').innerHTML = 'ğŸ‘¨â€ğŸ« TEACHER LOGIN';
      document.getElementById('pendingSection').style.display = 'none';
    }

  function addPendingEntry() {
  const name = prompt('Student Name:');
  if (!name || name.trim() === '') {
    alert('âŒ Name required!');
    return;
  }
  
  const site = prompt('Site URL (example: https://username.github.io/repo):\nMust contain "github.io"');
  if (!site || !site.includes('github.io')) {
    alert('âŒ Site must contain "github.io"!');
    return;
  }
  
  const repo = prompt('Repo URL (example: https://github.com/username/repo):\nMust contain "github.com"');
  if (!repo || !repo.includes('github.com')) {
    alert('âŒ Repo must contain "github.com"!');
    return;
  }
  
  // âœ… SUCCESS - Add to pending
  pending.unshift({
    name: name.trim(), 
    site: site.trim(), 
    repo: repo.trim(), 
    id: Date.now() + Math.random(),
    timestamp: new Date().toLocaleString()
  });
  
  localStorage.setItem('leaderboard-pending', JSON.stringify(pending));
  renderPending();
  alert(`âœ… "${name}" added to pending! Click ğŸš€ WEBPAGETEST APPROVE`);
}



    // ğŸ”¥ WEBPAGETEST AUTO-SCORING
    async function approve(id) {
      const entry = pending.find(e => e.id === id);
      if (entry) {
        document.querySelector(`button[onclick="approve(${entry.id})"]`).innerHTML = 'â³ Testing...';
        document.querySelector(`button[onclick="approve(${entry.id})"]`).className = 'approval-btn approval-testing';
        
        try {
          const testResult = await runWebPageTest(entry.site);
          leaderboard.unshift({
            ...entry,
            score: testResult.score,
            speedIndex: testResult.speedIndex,
            ttfb: testResult.ttfb
          });
          
          localStorage.setItem('leaderboard-approved', JSON.stringify(leaderboard));
          pending = pending.filter(e => e.id !== id);
          localStorage.setItem('leaderboard-pending', JSON.stringify(pending));
          
          renderPending();
          renderLeaderboard();
        } catch(e) {
          alert('Test failed! Using fallback score: ' + e.message);
          const score = 85;
          leaderboard.unshift({...entry, score, speedIndex: 'Manual', ttfb: 'N/A'});
          pending = pending.filter(e => e.id !== id);
          localStorage.setItem('leaderboard-approved', JSON.stringify(leaderboard));
          localStorage.setItem('leaderboard-pending', JSON.stringify(pending));
          renderPending();
          renderLeaderboard();
        }
      }
    }

    // ğŸš€ WEBPAGETEST PUBLIC API
    async function runWebPageTest(url) {
      document.getElementById('testProgress').style.display = 'flex';
      document.getElementById('testUrl').textContent = url.replace('https://', '');
      
      // Step 1: Submit test
      const testParams = new URLSearchParams({
        url: url,
        f: 'json',
        l: 'London:Chrome' // Fastest location
      });
      
      const submitResponse = await fetch(`${WPT_PUBLIC_URL}/runtest.php?${testParams}`);
      const submitData = await submitResponse.json();
      
      if (!submitData.data || !submitData.data.testId) {
        throw new Error('Failed to submit test');
      }
      
      const testId = submitData.data.testId;
      document.getElementById('testStatus').innerHTML = `Test ID: ${testId} - Waiting for results...`;
      
      // Step 2: Poll for results
      let result;
      for (let i = 0; i < 60; i++) { // 5 minutes max
        await new Promise(r => setTimeout(r, 5000)); // Poll every 5s
        
        const resultResponse = await fetch(`${WPT_PUBLIC_URL}/result/${testId}/?f=json`);
        result = await resultResponse.json();
        
        if (result.data.median && result.data.median.SpeedIndex) {
          break;
        }
        document.getElementById('testStatus').innerHTML = `Test ID: ${testId} - ${i*5}s remaining...`;
      }
      
      document.getElementById('testProgress').style.display = 'none';
      
      if (!result.data.median?.SpeedIndex) {
        throw new Error('Test incomplete - using fallback');
      }
      
      // Calculate score from Speed Index (lower = better)
      const speedIndex = result.data.median.SpeedIndex;
      const score = Math.max(50, Math.min(100, 100 - (speedIndex / 80)));
      
      return {
        score: Math.round(score),
        speedIndex: `${(speedIndex/1000).toFixed(1)}s`,
        ttfb: `${(result.data.median.TTFB/1000).toFixed(0)}ms`
      };
    }

    function reject(id) {
      pending = pending.filter(e => e.id !== id);
      localStorage.setItem('leaderboard-pending', JSON.stringify(pending));
      renderPending();
    }

    function renderPending() {
      document.getElementById('pendingList').innerHTML = pending.map(entry => `
        <div style="border:1px solid #ddd;padding:1.5rem;margin:1rem 0;border-radius:10px;background:#f8f9fa;">
          <strong>${entry.name}</strong> | ${entry.timestamp}<br>
          ğŸŒ <a href="${entry.site}" target="_blank">${entry.site.replace('https://','')}</a><br>
          ğŸ“‚ <a href="${entry.repo}" target="_blank">${entry.repo.replace('https://github.com/','')}</a><br>
          <button class="approval-btn approval-yes" onclick="approve(${entry.id})">ğŸš€ WEBPAGETEST APPROVE</button>
          <button class="approval-btn approval-no" onclick="reject(${entry.id})">âŒ REJECT</button>
        </div>
      `).join('') || '<p>No pending submissions</p>';
    }

    function renderLeaderboard() {
      leaderboard.sort((a,b) => b.score - a.score);
      const tbody = document.getElementById('leaderboard');
      const html = leaderboard.map((entry, i) => `
        <tr class="${i<3 ? 'rank-'+(i+1) : ''}">
          <td><strong>${i+1}ğŸ…</strong></td>
          <td><strong>${entry.name}</strong></td>
          <td><a href="${entry.site}" target="_blank">${entry.site.replace('https://','')}</a></td>
          <td><a href="${entry.repo}" target="_blank" class="repo-link">ğŸ“‚</a></td>
          <td>${entry.speedIndex || 'N/A'}</td>
          <td><span class="score-badge ${entry.score>=90 ? 'score-90plus' : ''}">${entry.score}</span></td>
          ${isLoggedIn ? `<td><button onclick="remove(${entry.id})" style="background:#dc3545;color:white;border:none;padding:0.3rem 0.8rem;border-radius:10px;cursor:pointer;">ğŸ—‘ï¸</button></td>` : ''}
        </tr>
      `).join('') || '<tr><td colspan="7" style="text-align:center;padding:2rem;color:#666;">No entries yet - submit via email to teacher!</td></tr>';
      
      tbody.innerHTML = html;
    }

    function remove(id) {
      leaderboard = leaderboard.filter(e => e.id !== id);
      localStorage.setItem('leaderboard-approved', JSON.stringify(leaderboard));
      renderLeaderboard();
    }
  </script>
</body>
</html>



